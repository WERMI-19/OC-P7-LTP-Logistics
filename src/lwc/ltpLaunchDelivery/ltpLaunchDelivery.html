<!-- LWC Template: ltpLaunchDelivery – écran de lancement de livraison -->
<!-- Règles: protégé par Custom Permission ; ne montre l'UI que si autorisé -->
<!-- Contenu: sélection zone (indicatif), chargement des options, choix transporteur, résumé fastest/cheapest -->
<!-- Accessibilité: labels explicites, éléments Lightning natifs -->
<!-- Expérience: spinner sur opérations ; messages d'information en cas d'absence d'options -->
<!-- Extension: on peut facilement ajouter un tableau détaillé des options si besoin -->
<template>
    <!-- Garde UI: si l'utilisateur n'a pas la permission, on affiche un message -->
    <template if:false={hasPermission}>
        <lightning-card title="Lancer la livraison">
            <div class="slds-p-around_medium">
                <lightning-formatted-text value="Accès refusé : permission requise (Can_Launch_Delivery)." ></lightning-formatted-text>
            </div>
        </lightning-card>
    </template>

    <!-- UI principale si permission OK -->
    <template if:true={hasPermission}>
        <lightning-card title="Lancer la livraison" icon-name="utility:truck">
            <!-- Spinner global -->
            <template if:true={loading}>
                <lightning-spinner alternative-text="Chargement..." size="small"></lightning-spinner>
            </template>

            <div class="slds-p-around_medium slds-grid slds-wrap slds-gutters">
                <!-- Choix visuel de la zone (indicatif) -->
                <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-3">
                    <lightning-combobox
                        name="zone"
                        label="Zone de livraison (indicative)"
                        value={zoneCode}
                        options={zoneOptions}
                        onchange={handleZoneChange}>
                    </lightning-combobox>
                </div>

                <!-- Bouton pour charger les options -->
                <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-3 slds-align_absolute-center">
                    <lightning-button
                        label="Charger les options"
                        title="Charger les options"
                        variant="brand"
                        onclick={loadOptions}
                        disabled={loading}>
                    </lightning-button>
                </div>


            </div>

            <!-- Résumé Fastest / Cheapest -->
            <div class="slds-p-horizontal_medium">
                <div class="slds-grid slds-wrap slds-gutters">
                    <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-2">
                        <lightning-tile label="Plus rapide" type="media">
                            <p>{fastestLabel}</p>
                        </lightning-tile>
                    </div>
                    <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-2">
                        <lightning-tile label="Moins chère" type="media">
                            <p>{cheapestLabel}</p>
                        </lightning-tile>
                    </div>
                </div>
            </div>

            <!-- Choix du transporteur (radio) si options disponibles -->
            <template if:true={hasData}>
                <div class="slds-p-around_medium">
                    <lightning-radio-group
                        name="carriers"
                        label="Choisissez un transporteur"
                        options={options}
                        value={selectedCarrier}
                        type="radio"
                        onchange={handleCarrierChange}>
                    </lightning-radio-group>
                </div>
            </template>

            <!-- Actions -->
            <div class="slds-p-around_medium slds-align_absolute-center">
                <lightning-button
                    label="Lancer la livraison"
                    title="Lancer la livraison"
                    variant="destructive"
                    onclick={handleLaunch}
                    disabled={disableLaunch}>
                </lightning-button>
            </div>
        </lightning-card>
    </template>
</template>
